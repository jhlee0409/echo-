# Echo AI Companion Game (Soulmate) - Project Guide

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**Echo**ëŠ” Claude APIë¥¼ í™œìš©í•œ í•œêµ­ì–´ AI ì»´íŒ¨ë‹ˆì–¸ RPG ê²Œì„ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” AI ì»´íŒ¨ë‹ˆì–¸ "ì•„ë¦¬ì•„"ì™€ ì‹¤ì‹œê°„ìœ¼ë¡œ ëŒ€í™”í•˜ë©° ê´€ê³„ë¥¼ ë°œì „ì‹œì¼œ ë‚˜ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•
- ğŸ¤– **Claude API ê¸°ë°˜ ì‹¤ì‹œê°„ ì±„íŒ…**: ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ ëŒ€í™”
- ğŸ­ **ê°œì„± ìˆëŠ” AI ì»´íŒ¨ë‹ˆì–¸**: ì„±ê²© íŠ¹ì„±ê³¼ ê°ì • ìƒíƒœ ê¸°ë°˜ ì‘ë‹µ
- ğŸ“ˆ **ê´€ê³„ ë°œì „ ì‹œìŠ¤í…œ**: ëŒ€í™”ë¥¼ í†µí•œ ê²½í—˜ì¹˜ ë° ì¹œë°€ë„ ì¦ê°€
- ğŸ”„ **ì§€ëŠ¥í˜• Fallback**: API ì¥ì•  ì‹œ Mock Provider ìë™ ì „í™˜
- âš¡ **ì„±ëŠ¥ ìµœì í™”**: ì‘ë‹µ ìºì‹±, í† í° ê´€ë¦¬, ì„œí‚· ë¸Œë ˆì´ì»¤ íŒ¨í„´

---

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ components/          # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ screens/         # ê²Œì„ í™”ë©´ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ chat/           # ì±„íŒ… UI ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ ui/             # ê³µí†µ UI ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ store/              # Zustand ìƒíƒœ ê´€ë¦¬
â”‚   â””â”€â”€ gameStore.ts    # ë©”ì¸ ê²Œì„ ìƒíƒœ (ì±„íŒ… ë¡œì§ í¬í•¨)
â”œâ”€â”€ services/           # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ ai/            # AI ì„œë¹„ìŠ¤ (í•µì‹¬)
â”‚   â”œâ”€â”€ auth/          # ì¸ì¦ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ database/      # DB ì„œë¹„ìŠ¤
â”œâ”€â”€ types/              # TypeScript íƒ€ì… ì •ì˜
â”œâ”€â”€ config/            # í™˜ê²½ ì„¤ì •
â””â”€â”€ hooks/             # React ì»¤ìŠ¤í…€ í›…
```

### ğŸ§  AI ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

**Provider Hierarchy**: Claude API â†’ Mock Provider (Fallback)

```
AIManager (src/services/ai/AIManager.ts)
â”œâ”€â”€ ClaudeProvider: Claude API í†µì‹ 
â”œâ”€â”€ MockProvider: í…œí”Œë¦¿ ê¸°ë°˜ ì‘ë‹µ (Fallback)
â”œâ”€â”€ CostOptimizer: ë¹„ìš©/ì„±ëŠ¥ ìµœì í™”
â””â”€â”€ SimpleCache: ì‘ë‹µ ìºì‹±
```

---

## ğŸš€ ê°œë°œ í™˜ê²½ ì„¤ì •

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# .env.local íŒŒì¼ ìƒì„±
VITE_CLAUDE_API_KEY=sk-ant-api03-...
VITE_SUPABASE_URL=https://...
VITE_SUPABASE_ANON_KEY=...
```

### 2. ê°œë°œ ì„œë²„ ì‹¤í–‰
```bash
npm install
npm run dev          # ê°œë°œ ì„œë²„ ì‹œì‘ (í¬íŠ¸ 5173)
npm run build        # í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run type-check   # TypeScript ê²€ì¦
npm run lint         # ESLint ê²€ì‚¬
npm run test         # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```

### 3. Vite Proxy ì„¤ì •
- Claude API í˜¸ì¶œì€ Vite proxyë¥¼ í†µí•´ CORS ìš°íšŒ (`/api/claude/*`)
- API í‚¤ëŠ” proxy ì„¤ì •ì—ì„œ ìë™ìœ¼ë¡œ í—¤ë”ì— ì¶”ê°€

---

## ğŸ’¬ í•µì‹¬ ì±„íŒ… ì‹œìŠ¤í…œ

### ë°ì´í„° í”Œë¡œìš°
1. **ì‚¬ìš©ì ì…ë ¥** â†’ `gameStore.sendMessage()`
2. **Context êµ¬ì„±** â†’ ì»´íŒ¨ë‹ˆì–¸ ìƒíƒœ, ê´€ê³„ ì •ë³´, ìµœê·¼ ëŒ€í™” ì£¼ì œ
3. **AI ìš”ì²­** â†’ `AIManager.generateResponse()`
4. **Provider ì„ íƒ** â†’ Claude API (ìš°ì„ ) â†’ Mock (Fallback)
5. **ì‘ë‹µ ì²˜ë¦¬** â†’ ë©”ì‹œì§€ ì¶”ê°€, ê°ì • ì—…ë°ì´íŠ¸, ê²½í—˜ì¹˜ ì¦ê°€

### ì£¼ìš” ì½”ë“œ ìœ„ì¹˜

**gameStore.ts:248-381** - ì±„íŒ… ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§
```typescript
// ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
const buildContext = () => ({
  companionName: state.companion!.name,
  companionPersonality: state.companion!.personalityTraits,
  relationshipLevel: state.companion!.relationshipStatus.level,
  // ... ê¸°íƒ€ ì»¨í…ìŠ¤íŠ¸
})

// AI ì„œë¹„ìŠ¤ í˜¸ì¶œ
const aiResponse = await aiManager.generateResponse(aiRequest)
```

**AIManager.ts:160-206** - AI ì‘ë‹µ ìƒì„± ë©”ì¸ ë¡œì§
```typescript
// ìºì‹± í™•ì¸ â†’ Provider ì„ íƒ â†’ Fallback ì²˜ë¦¬ â†’ ì‘ë‹µ ìºì‹±
async generateResponse(request: AIRequest): Promise<AIResponse>
```

---

## ğŸ”§ ì¤‘ìš”í•œ ì»´í¬ë„ŒíŠ¸ë“¤

### 1. GameStore (`src/store/gameStore.ts`)
- **ì±…ì„**: ì „ì²´ ê²Œì„ ìƒíƒœ ê´€ë¦¬ ë° ì±„íŒ… ì‹œìŠ¤í…œ í†µí•©
- **ì£¼ìš” ê¸°ëŠ¥**: 
  - ì»´íŒ¨ë‹ˆì–¸ ìƒíƒœ ê´€ë¦¬ (ê°ì •, ì„±ê²©, ê´€ê³„ë„)
  - ëŒ€í™” ê¸°ë¡ ê´€ë¦¬
  - AI ì„œë¹„ìŠ¤ í†µí•©
  - ê²½í—˜ì¹˜ ë° ë ˆë²¨ ê´€ë¦¬

### 2. AIManager (`src/services/ai/AIManager.ts`)
- **ì±…ì„**: AI Provider ê´€ë¦¬ ë° ìš”ì²­ ë¼ìš°íŒ…
- **ì£¼ìš” ê¸°ëŠ¥**:
  - Provider selection (Claude â†’ Mock)
  - ì‘ë‹µ ìºì‹± (5ë¶„ TTL)
  - ì„œí‚· ë¸Œë ˆì´ì»¤ íŒ¨í„´ (5íšŒ ì‹¤íŒ¨ ì‹œ ì°¨ë‹¨)
  - ì¬ì‹œë„ ë¡œì§ (3íšŒ ì‹œë„, ì§€ìˆ˜ ë°±ì˜¤í”„)

### 3. ClaudeProvider (`src/services/ai/providers/ClaudeProvider.ts`)
- **ì±…ì„**: Claude APIì™€ì˜ ì‹¤ì œ í†µì‹ 
- **ì£¼ìš” ê¸°ëŠ¥**:
  - API ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬
  - í•œêµ­ì–´ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±
  - ê°ì • ë¶„ì„ ë° ì‹ ë¢°ë„ ê³„ì‚°
  - ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë¶„ë¥˜

### 4. í™˜ê²½ ì„¤ì • (`src/config/env.ts`)
- **ì±…ì„**: í™˜ê²½ ë³€ìˆ˜ ë¡œë”© ë° ê²€ì¦
- **íŠ¹ì§•**: API í‚¤ í˜•ì‹ ê²€ì¦, ê°œë°œ/ìš´ì˜ í™˜ê²½ ë¶„ë¦¬

---

## ğŸ¯ ì¼ë°˜ì ì¸ ì‘ì—… íŒ¨í„´

### AI ì±„íŒ… ê´€ë ¨ ìˆ˜ì •
1. **ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì •**: `gameStore.ts`ì˜ `buildContext()` í•¨ìˆ˜
2. **ì‘ë‹µ ì²˜ë¦¬ ìˆ˜ì •**: `applyAIResponse()` í•¨ìˆ˜
3. **í”„ë¡¬í”„íŠ¸ ìˆ˜ì •**: `ClaudeProvider.ts`ì˜ `buildSystemPrompt()`

### ìƒˆë¡œìš´ Provider ì¶”ê°€
1. `AIProvider` ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
2. `AIManager.initializeProviders()`ì— ë“±ë¡
3. ìš°ì„ ìˆœìœ„ ë° Fallback ì²´ì¸ ì„¤ì •

### ìƒíƒœ ê´€ë¦¬ í™•ì¥
1. íƒ€ì… ì •ì˜: `src/types/index.ts`
2. ìƒíƒœ ì¶”ê°€: `gameStore.ts`ì˜ interface ë° initial state
3. ì•¡ì…˜ ì¶”ê°€: store actions

---

## ğŸ“Š ì„±ëŠ¥ ë° ëª¨ë‹ˆí„°ë§

### ì£¼ìš” ë©”íŠ¸ë¦­
- **ì‘ë‹µ ì‹œê°„**: Claude API <2000ms, Mock <100ms, Cache <50ms
- **ìºì‹œ ì ì¤‘ë¥ **: >30% ëª©í‘œ
- **í† í° ì‚¬ìš©ëŸ‰**: í‰ê·  105 í† í°/ëŒ€í™” (45 ì…ë ¥ + 60 ì¶œë ¥)
- **ì˜¤ë¥˜ìœ¨**: <10% ëª©í‘œ

### ë¡œê¹…
```typescript
console.log('ğŸ¤– Sending request to AI service...')
console.log('âœ… AI Response received from ${provider}')
console.log('ğŸ¥ AI Manager Health Status:', healthStatus)
```

### ë””ë²„ê¹… ë„êµ¬
- ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ AI ìš”ì²­/ì‘ë‹µ í™•ì¸
- `ENV.ENABLE_DEBUG_MODE = true`ë¡œ ìƒì„¸ ë¡œê¹… í™œì„±í™”
- Zustand devtoolsë¡œ ìƒíƒœ ë³€í™” ì¶”ì 

---

## ğŸš¨ ì•Œë ¤ì§„ ì´ìŠˆ ë° í•´ê²° ë°©ë²•

### 1. API í‚¤ ê´€ë ¨
- **ë¬¸ì œ**: API í‚¤ ë…¸ì¶œ ë˜ëŠ” ì¸ì¦ ì‹¤íŒ¨
- **í•´ê²°**: í™˜ê²½ ë³€ìˆ˜ í™•ì¸, í‚¤ í˜•ì‹ ê²€ì¦ (`sk-ant-` ì‹œì‘)
- **íŒŒì¼**: `src/config/env.ts:203-205`

### 2. Import ì˜¤ë¥˜
- **ë¬¸ì œ**: `Failed to resolve import "@utils/serviceTest"`
- **í•´ê²°**: ì‚­ì œëœ íŒŒì¼ import ì œê±° ì™„ë£Œ
- **ìƒíƒœ**: í•´ê²°ë¨ (2024-08-10)

### 3. AIManager ë©”ì„œë“œ ëˆ„ë½
- **ë¬¸ì œ**: `aiManager.isHealthy is not a function`
- **í•´ê²°**: `isHealthy()` ë©”ì„œë“œ ì¶”ê°€ ì™„ë£Œ
- **íŒŒì¼**: `AIManager.ts:464-484`

---

## ğŸ›¡ï¸ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### API í‚¤ ë³´ì•ˆ
- í™˜ê²½ ë³€ìˆ˜ë§Œ ì‚¬ìš©, í•˜ë“œì½”ë”© ê¸ˆì§€
- Pre-commit hookìœ¼ë¡œ ë¯¼ê° ì •ë³´ ì»¤ë°‹ ë°©ì§€ (ì„¤ì • í•„ìš”)
- BFG Cleanerë¡œ Git íˆìŠ¤í† ë¦¬ ì •ë¦¬ (ì™„ë£Œ)

### ì…ë ¥ ê²€ì¦
- ì‚¬ìš©ì ë©”ì‹œì§€ ê¸¸ì´ ì œí•œ
- XSS ë°©ì§€ë¥¼ ìœ„í•œ ì…ë ¥ sanitization
- Rate limiting (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)

---

## ğŸ“ ì¶”ê°€ ë¬¸ì„œ

- **ì„¤ê³„ ëª…ì„¸ì„œ**: `CLAUDE_AI_CHAT_DESIGN_SPEC.md` - AI ì±„íŒ… ì‹œìŠ¤í…œ ìƒì„¸ ì„¤ê³„
- **ë³´ì•ˆ ê°€ì´ë“œ**: `SECURITY_CLEANUP_GUIDE.md` - API í‚¤ ë³´ì•ˆ ê´€ë¦¬ ê°€ì´ë“œ
- **ì‹¤í–‰ ê³„íš**: `execution-plan.md` - í”„ë¡œì íŠ¸ êµ¬í˜„ ë¡œë“œë§µ

---

## ğŸ”„ ìµœê·¼ ì—…ë°ì´íŠ¸ (2024-08-10)

1. âœ… **API í‚¤ ë³´ì•ˆ ê°•í™”**: Git íˆìŠ¤í† ë¦¬ì—ì„œ ë…¸ì¶œëœ í‚¤ ì™„ì „ ì œê±°
2. âœ… **ë™ì  ì±„íŒ… êµ¬í˜„**: Mock ì‘ë‹µì„ ì‹¤ì œ Claude API í˜¸ì¶œë¡œ ì „í™˜
3. âœ… **AIManager ì•ˆì •ì„± ê°œì„ **: `isHealthy()` ë©”ì„œë“œ ì¶”ê°€, ì˜¤ë¥˜ ì²˜ë¦¬ ê°•í™”
4. âœ… **Import ì˜¤ë¥˜ í•´ê²°**: `serviceTest` ê´€ë ¨ ìˆœí™˜ ì˜ì¡´ì„± í•´ê²°
5. âœ… **ì„¤ê³„ ë¬¸ì„œ ì‘ì„±**: 117KB ìƒì„¸ ì„¤ê³„ ëª…ì„¸ì„œ ì™„ì„±

### í˜„ì¬ ìƒíƒœ
- ğŸŸ¢ **Claude API ì—°ë™**: ì •ìƒ ì‘ë™ (ìƒˆ API í‚¤ ì ìš©)
- ğŸŸ¢ **ì±„íŒ… ì‹œìŠ¤í…œ**: ì‹¤ì‹œê°„ ëŒ€í™” ê°€ëŠ¥
- ğŸŸ¢ **Fallback ì‹œìŠ¤í…œ**: Mock Provider ì •ìƒ ì‘ë™
- ğŸŸ¡ **ë³´ì•ˆ**: Pre-commit hook ì„¤ì • í•„ìš”
- ğŸŸ¡ **ëª¨ë‹ˆí„°ë§**: ìë™í™”ëœ ë³´ì•ˆ ìŠ¤ìº” ì„¤ì • í•„ìš”

---

*ì´ ë¬¸ì„œëŠ” Echo í”„ë¡œì íŠ¸ì—ì„œ ì‘ì—…í•˜ëŠ” Claude AIë¥¼ ìœ„í•œ ì¢…í•© ê°€ì´ë“œì…ë‹ˆë‹¤. í”„ë¡œì íŠ¸ êµ¬ì¡°, í•µì‹¬ ë¡œì§, ì¼ë°˜ì ì¸ ì‘ì—… íŒ¨í„´ì„ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.*